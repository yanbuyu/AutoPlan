name: autoUpdate

on: 
  repository_dispatch:
  workflow_dispatch:

# 定时触发编译 每两个小时一次
  schedule:
    - cron: 0 0,1,6-23 * * *

# 点赞☆Star触发编译
#  watch:
#    types: [started]

jobs:
  autoUpdate:
    runs-on: ubuntu-20.04
    steps:
    - name: Clone Repository
      uses: actions/checkout@v2

    - name: Initialization environment
      env:
        DEBIAN_FRONTEND: noninteractive
      run: |
        sudo timedatectl set-timezone "Asia/Shanghai"
        sudo -E apt-get install -y openjdk-8-jdk python3 python3-pip curl wget p7zip p7zip-full aria2 git
        sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 1
        sudo update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 1
        sudo pip install protobuf Beautifulsoup4 requests xmltodict lanzou-api colorama filetype chardet aligo protobuf six
        git clone https://github.com/yanbuyu/MIUIPatch.git
        cd MIUIPatch
        touch ./passWord.txt
        python ./pyscript/toolpy/config.py

    - name: auto UMSR
      run: |
        sudo python ./pyscript/mainpy/autoUpdate.py

    #- name: Upload zip
    #  uses: actions/upload-artifact@main
    #  with:
    #    name: UMSR Patch
    #    path: out/*.zip
